<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dialecte ‚Äì Accueil</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="header">
    <a href="index.html" class="home-icon">üè†</a>
    <h1 class="logo">Dialecte</h1>
    <div class="header-auth" id="header-auth">
      <!-- Les boutons seront inject√©s ici par le script -->
    </div>
  </header>

  <nav class="mobile-nav">
    <a href="index.html">Lexique</a>
    <a href="discovery.html">D√©couvrir</a>
    <a href="review.html">R√©viser</a>
    <a href="quiz.html">Quiz Classique</a>
    <a href="progres.html">Mes progr√®s</a>
  </nav>

  <div class="layout">
    <nav class="sidebar">
      <ul>
        <li><a href="index.html">Lexique</a></li>
        <li><a href="discovery.html">D√©couvrir</a></li>
        <li><a href="review.html">R√©viser</a></li>
        <li><a href="quiz.html">Quiz Classique</a></li>
        <li><a href="progres.html">Mes progr√®s</a></li>
      </ul>
    </nav>

    <main class="main">
      <section class="info-section" style="background:#f9fafc; border-left:4px solid #4F8A8B; padding:1.5em 1em; border-radius:8px; margin-bottom:2em; max-width:600px; margin-left:auto; margin-right:auto;">
        <h2 style="font-size:1.2em; margin-bottom:0.5em; color:#4F8A8B;">Quelle est la diff√©rence entre <b>Mode D√©couverte</b> et <b>Quiz Classique</b>‚ÄØ?</h2>
        <ul style="margin:0 0 0 1em; padding:0;">
          <li><b>Mode D√©couverte</b>‚ÄØ: D√©couvre de nouveaux mots selon leur fr√©quence, chaque mot d√©couvert est ajout√© √† ton historique de r√©vision (SM-2).</li>
          <li><b>Quiz Classique</b>‚ÄØ: Teste-toi librement sur tout le lexique, sans impact sur ton historique de r√©vision. Id√©al pour s'entra√Æner ou jouer.</li>
        </ul>
      </section>

      <h2>Bienvenue sur Dialecte !</h2>
      
      <!-- Section des modes d'apprentissage -->
      <section class="learning-modes">
        <h3>Modes d'apprentissage</h3>
        <div class="mode-cards">
          <div class="mode-card">
            <h4>üîç Mode D√©couverte</h4>
            <p>Apprenez de nouveaux mots avec des quiz √† choix multiples</p>
            <a href="discovery.html" class="btn btn-primary">Commencer</a>
          </div>
          <div class="mode-card">
            <h4>üîÑ Mode R√©vision</h4>
            <p>R√©visez les mots appris avec la r√©p√©tition espac√©e</p>
            <a href="review.html" class="btn btn-secondary" id="review-btn">R√©viser (<span id="due-count">0</span>)</a>
          </div>
          <div class="mode-card">
            <h4>üéØ Quiz Classique</h4>
            <p>Testez vos connaissances avec le quiz traditionnel</p>
            <a href="quiz.html" class="btn btn-primary">Commencer</a>
          </div>
        </div>
      </section>

      <div class="quiz-buttons" style="display:flex; gap:2em; justify-content:center; margin-bottom:2em;">
        <a href="discovery.html" class="btn btn-primary">Mode D√©couverte</a>
        <a href="quiz.html" class="btn btn-secondary">Quiz Classique</a>
      </div>
      <div style="text-align:center; color:#4F8A8B; font-size:1.1em; margin-bottom:2em; max-width:600px; margin-left:auto; margin-right:auto; background:#f9fafc; border-radius:8px; padding:1.2em 1em;">
        <b>D√©couvre, r√©vise, progresse‚ÄØ!</b><br>
        Cette application t'aide √† apprendre le kabyle facilement‚ÄØ:<br>
        <ul style="text-align:left; margin:0.7em auto 0.7em 1.2em; max-width:500px;">
          <li>D√©couvre de nouveaux mots adapt√©s √† ton niveau.</li>
          <li>R√©vise r√©guli√®rement gr√¢ce √† un syst√®me intelligent (SM-2) qui optimise la m√©morisation.</li>
          <li>Joue √† des quiz pour t'entra√Æner et tester tes connaissances.</li>
        </ul>
        <span style="font-size:0.98em; color:#3b5c5c;">Tout ton historique de progression est sauvegard√©‚ÄØ: tu peux reprendre o√π tu t'es arr√™t√©, sur n'importe quel appareil.</span>
      </div>

      <section id="lexique">
        <h2>Lexique th√©matique</h2>
        <div class="lexique-controls">
          <label for="theme-select">Filtrer par th√®me :</label>
          <select id="theme-select">
            <option value="all">Tous les th√®mes</option>
          </select>
        </div>
        <div id="lexique-content">Chargement du lexique‚Ä¶</div>
      </section>
    </main>
  </div>

  <script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="cards.js"></script>
  <script type="module">
    import { auth, logout, initAuthListener } from "./firebase.js";

    const headerAuth = document.getElementById('header-auth');

    function renderAuthButtons(user) {
      headerAuth.innerHTML = '';
      if (user) {
        // Si connect√©, afficher Se d√©connecter
        const btn = document.createElement('button');
        btn.textContent = 'Se d√©connecter';
        btn.className = 'btn auth';
        btn.onclick = async () => {
          await logout();
          location.reload();
        };
        headerAuth.appendChild(btn);
      } else {
        // si non connect√©, afficher Se connecter / S'inscrire
        const login = document.createElement('a');
        login.href = 'login.html';
        login.textContent = 'Se connecter';
        login.className = 'btn auth';
        const signup = document.createElement('a');
        signup.href = 'signup.html';
        signup.textContent = "S'inscrire";
        signup.className = 'btn auth';
        headerAuth.append(login, signup);
      }
    }

    initAuthListener(user => {
      renderAuthButtons(user);
    });

    // Initialiser le gestionnaire de cartes et mettre √† jour le compteur
    async function updateDueCount() {
      await cardManager.loadCards();
      const stats = cardManager.getStats();
      document.getElementById('due-count').textContent = stats.due;
    }

    // Mettre √† jour le compteur au chargement
    updateDueCount();

    // G√©n√©ration dynamique du lexique √† partir de data3.csv
    const THEMES = [
      { nom: 'Verbes', mots: ['√™tre','venir','dire','voir','faire','manger','boire','prendre','aller','accompagner','jurer','tisser','r√©aliser','armer'] },
      { nom: 'Nature', mots: ['eau','arbre','ciel','soleil','lune','terre','vent','montagne','herbe','mer','foin','boue','baie','oasis'] },
      { nom: 'Corps humain', mots: ['main','t√™te','jambe','nez','bouche','≈ìil','oreille','pied','dent','dos','cou','peau','sein','sang'] },
      { nom: 'Animaux', mots: ['chat','bouc','hy√®ne','√¢ne','chien','oiseau','poisson','vache','mouton','cheval'] },
      { nom: 'Nourriture', mots: ['pain','lait','fromage','viande','fruit','l√©gume','miel','bi√®re','melon','noix'] },
      { nom: 'Maison', mots: ['maison','porte','fen√™tre','chambre','lit','cuisine','table','chaise','cl√©'] },
      { nom: 'V√™tements', mots: ['chemise','pantalon','robe','manteau','chapeau','chaussure','tablier'] },
      { nom: 'Couleurs', mots: ['bleu','blanc','noir','rouge','vert','jaune','gris'] },
      { nom: 'Famille', mots: ['p√®re','m√®re','fr√®re','soeur','fils','fille','oncle','tante','grand-m√®re','grand-p√®re'] },
      { nom: 'Objets du quotidien', mots: ['table','chaise','porte','fen√™tre','lit','bol','cuir','bouteille','cl√©'] }
    ];
    function detectTheme(fr) {
      for (const t of THEMES) {
        for (const mot of t.mots) {
          if (fr.toLowerCase().includes(mot)) return t.nom;
        }
      }
      return 'Autres';
    }
    function renderLexique(data) {
      const themes = {};
      data.forEach(row => {
        const fr = row['Fran√ßais']?.trim();
        const kab = row['Kabyle']?.trim();
        if (!fr || !kab) return;
        const theme = detectTheme(fr);
        if (!themes[theme]) themes[theme] = [];
        // S√©parer les traductions multiples
        const traductions = kab.split('/').map(t => t.trim()).filter(t => t);
        themes[theme].push({ fr, kab });
      });
      // Remplir dynamiquement le menu d√©roulant avec les th√®mes d√©tect√©s
      const themeSelect = document.getElementById('theme-select');
      themeSelect.innerHTML = '<option value="all">Tous les th√®mes</option>';
      Object.keys(themes).forEach(theme => {
        const option = document.createElement('option');
        option.value = theme;
        option.textContent = theme;
        themeSelect.appendChild(option);
      });
      // Affichage filtr√©
      function displayLexique(selectedTheme = 'all') {
        let html = '';
        Object.keys(themes).forEach(theme => {
          if (selectedTheme === 'all' || theme === selectedTheme) {
            html += `<div class='lexique-theme'><h3>${theme}</h3><ul class='lexique-list'>`;
            themes[theme].forEach(({fr, kab}) => {
              html += `<li><span class='fr'>${fr}</span> <span class='kab'>${kab}</span></li>`;
            });
            html += '</ul></div>';
          }
        });
        document.getElementById('lexique-content').innerHTML = html;
      }
      displayLexique();
      themeSelect.addEventListener('change', (e) => {
        displayLexique(e.target.value);
      });
    }
    Papa.parse('/data3.csv', {
      download: true,
      header: true,
      skipEmptyLines: true,
      delimiter: ';',
      complete: ({ data }) => renderLexique(data)
    });
  </script>
</body>
</html>