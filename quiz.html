import Papa from 'papaparse';

const csvFilePath = 'kabyle_glide_import_sample20.csv';

let questions = [];
let currentIndex = 0;
let revealed = false;

const front = document.getElementById('front');
const back = document.getElementById('back');
const choicesDiv = document.getElementById('choices');
const prevBtn = document.getElementById('prev');
const nextBtn = document.getElementById('next');
const revealBtn = document.getElementById('reveal');
const speakBtn = document.getElementById('speak');

function loadCSV() {
  Papa.parse(csvFilePath, {
    download: true,
    header: true,
    complete: function(results) {
      questions = results.data.filter(q => q.Front && q.Back);
      currentIndex = 0;
      showQuestion(currentIndex);
    },
    error: function(err) {
      console.error('Error loading CSV:', err);
    }
  });
}

function showQuestion(index) {
  if (index < 0 || index >= questions.length) return;
  revealed = false;
  const q = questions[index];
  front.textContent = q.Front;
  back.textContent = '';
  choicesDiv.innerHTML = '';
  revealBtn.textContent = 'Révéler';
}

function revealAnswer() {
  if (revealed) {
    back.textContent = '';
    revealBtn.textContent = 'Révéler';
    revealed = false;
  } else {
    back.textContent = questions[currentIndex].Back;
    revealBtn.textContent = 'Cacher';
    revealed = true;
  }
}

prevBtn.addEventListener('click', () => {
  if (currentIndex > 0) {
    currentIndex--;
    showQuestion(currentIndex);
  }
});

nextBtn.addEventListener('click', () => {
  if (currentIndex < questions.length -1) {
    currentIndex++;
    showQuestion(currentIndex);
  }
});

revealBtn.addEventListener('click', revealAnswer);

speakBtn.addEventListener('click', () => {
  const utterance = new SpeechSynthesisUtterance(front.textContent);
  utterance.lang = 'fr-FR';
  window.speechSynthesis.speak(utterance);
});

loadCSV();